<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>利用規約同意システム</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    .terms-section {
      margin-bottom: 30px;
    }
    .terms-section h2 {
      display: flex;
      align-items: center;
      font-size: 1.2em;
    }
    .read-aloud-btn {
      margin-left: 10px;
      cursor: pointer;
      font-size: 1em;
    }
    .terms-content {
      max-height: 200px;
      overflow-y: scroll;
      border: 1px solid #ccc;
      padding: 10px;
      background-color: #f9f9f9;
      margin-top: 10px;
    }
    .terms-content p {
      margin: 10px 0;
    }
    label {
      display: flex;
      align-items: center;
      margin-top: 10px;
    }
    .scroll-checkmark {
      margin-left: 10px;
      font-weight: bold;
    }
    #consent-button {
      padding: 10px 20px;
      background-color: #ccc;
      border: none;
      cursor: not-allowed;
      font-size: 1em;
    }
    #consent-button.enabled {
      background-color: #4CAF50;
      color: white;
      cursor: pointer;
    }
    #remaining-count {
      font-weight: bold;
      margin-bottom: 20px;
    }
  </style>
</head>
<body>

  <div id="remaining-count">あと5項目の同意が必要です</div>

  <div class="terms-section" id="terms-location">
    <h2>
      位置情報共有に関する利用規約
      <button class="read-aloud-btn" aria-label="音声読み上げ">🔊</button>
    </h2>
    <div class="terms-content" tabindex="0">
      <p><strong>📍 位置情報の取得:</strong> 当サービスは、ユーザーの現在地を取得します。</p>
      <p><strong>🔒 プライバシー保護:</strong> 取得した位置情報は、第三者と共有しません。</p>
      <p><strong>📅 利用目的:</strong> 位置情報は、最寄りの店舗やイベント情報の提供に使用されます。</p>
      <p><strong>⚠️ 注意事項:</strong> 位置情報の取得を拒否した場合、一部機能が制限される可能性があります。</p>
    </div>
    <label>
      <input type="checkbox" disabled>
      利用規約に同意する <span class="scroll-checkmark">❌</span>
    </label>
  </div>

  <div class="terms-section" id="terms-top">
    <h2>
      トップページに関する利用規約
      <button class="read-aloud-btn" aria-label="音声読み上げ">🔊</button>
    </h2>
    <div class="terms-content" tabindex="0">
      <p><strong>🏠 サービス概要:</strong> トップページでは、当サービスの概要や最新情報を提供します。</p>
      <p><strong>🔗 外部リンク:</strong> トップページには、外部サイトへのリンクが含まれる場合があります。</p>
      <p><strong>📄 情報の正確性:</strong> 掲載情報の正確性には努めていますが、保証は致しかねます。</p>
      <p><strong>⚠️ 免責事項:</strong> トップページの利用により生じた損害について、当社は一切の責任を負いません。</p>
    </div>
    <label>
      <input type="checkbox" disabled>
      利用規約に同意する <span class="scroll-checkmark">❌</span>
    </label>
  </div>

  <div class="terms-section" id="terms-event">
    <h2>
      イベント情報ページに関する利用規約
      <button class="read-aloud-btn" aria-label="音声読み上げ">🔊</button>
    </h2>
    <div class="terms-content" tabindex="0">
      <p><strong>🎉 イベント情報の提供:</strong> 当サービスは、近隣のイベント情報を提供します。</p>
      <p><strong>📅 情報の更新:</strong> イベント情報は随時更新されますが、最新であることを保証するものではありません。</p>
      <p><strong>🔗 外部リンク:</strong> イベント詳細は、主催者の公式サイトへのリンクを含む場合があります。</p>
      <p><strong>⚠️ 注意事項:</strong> イベントの中止や変更について、当社は一切の責任を負いません。</p>
    </div>
    <label>
      <input type="checkbox" disabled>
      利用規約に同意する <span class="scroll-checkmark">❌</span>
    </label>
  </div>

  <div class="terms-section" id="terms-shop">
    <h2>
      店舗情報ページに関する利用規約
      <button class="read-aloud-btn" aria-label="音声読み上げ">🔊</button>
    </h2>
    <div class="terms-content" tabindex="0">
      <p><strong>🏪 店舗情報の提供:</strong> 当サービスは、近隣の店舗情報を提供します。</p>
      <p><strong>📄 情報の正確性:</strong> 掲載されている店舗情報の正確性には努めていますが、保証は致しかねます。</p>
      <p><strong>🔗 外部リンク:</strong> 店舗詳細は、各店舗の公式サイトへのリンクを含む場合があります。</p>
      <p><strong>⚠️ 注意事項:</strong> 店舗の営業時間や定休日の変更について、当社は一切の責任を負いません。</p>
    </div>
    <label>
      <input type="checkbox" disabled>
      利用規約に同意する <span class="scroll-checkmark">❌</span>
    </label>
  </div>

  <div class="terms-section" id="terms-analytics">
    <h2>
      Googleアナリティクスの使用に関する注意
      <button class="read-aloud-btn" aria-label="音声読み上げ">🔊</button>
    </h2>
    <div class="terms-content" tabindex="0">
      <p><strong>📊 データ収集:</strong> 当サービスは、Googleアナリティクスを使用して、利用状況の分析を行います。</p>
      <p><strong>🔒 プライバシー保護:</strong> 収集されたデータは、匿名化され、個人を特定するものではありません。</p>
      <p><strong>⚙️ クッキーの使用:</strong> Googleアナリティクスは、クッキーを使用してデータを収集します。</p>
      <p><strong>⚠️ 注意事項:</strong> 自動的にデータは収集されます。現在対策を行っておりますが、解決まではしばらくお待ち下さい。</p>
    </div>
     <label>
      <input type="checkbox" disabled>
      利用規約に同意する <span class="scroll-checkmark">❌</span>
     </label>
  </div>

  <button id="consent-button" disabled>全ての利用規約に同意してサービスの利用を開始する</button>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
  const termsSections = document.querySelectorAll('.terms-section');
  const consentButton = document.getElementById('consent-button');
  const remainingCount = document.getElementById('remaining-count');
  let checksCompleted = 0;

  termsSections.forEach(section => {
    const content = section.querySelector('.terms-content');
    const checkbox = section.querySelector('input[type="checkbox"]');
    const checkmark = section.querySelector('.scroll-checkmark');
    const readAloudBtn = section.querySelector('.read-aloud-btn');
    let timerCompleted = false;
    let scrolledToBottom = false;

    // タイマー制限
    setTimeout(() => {
      timerCompleted = true;
    }, 10000);

    // スクロールイベント
    content.addEventListener('scroll', () => {
      if (!timerCompleted || scrolledToBottom) return;
      if (content.scrollTop + content.clientHeight >= content.scrollHeight) {
        scrolledToBottom = true;
        checkbox.disabled = false;
        checkmark.textContent = '✅';
      }
    });

    // チェックボックスの変更イベント
    checkbox.addEventListener('change', () => {
      if (checkbox.checked) {
        checksCompleted++;
      } else {
        checksCompleted--;
      }
      const remaining = termsSections.length - checksCompleted;
      remainingCount.textContent = `あと${remaining}項目の同意が必要です`;
      if (remaining === 0) {
        consentButton.disabled = false;
        consentButton.classList.add('enabled');
      } else {
        consentButton.disabled = true;
        consentButton.classList.remove('enabled');
      }
    });

    // 音声読み上げボタン
    readAloudBtn.addEventListener('click', () => {
      const utterance = new SpeechSynthesisUtterance(content.textContent);
      speechSynthesis.speak(utterance);
    });
  });
});

          // Cookieをセット
function setCookie(name, value, days) {
  const d = new Date();
  d.setTime(d.getTime() + (days*24*60*60*1000));
  const expires = "expires="+ d.toUTCString();
  document.cookie = name + "=" + value + ";" + expires + ";path=/";
}

// Cookieを取得
function getCookie(name) {
  const cname = name + "=";
  const decodedCookie = decodeURIComponent(document.cookie);
  const ca = decodedCookie.split(';');
  for(let i = 0; i < ca.length; i++) {
    let c = ca[i];
    while (c.charAt(0) == ' ') c = c.substring(1);
    if (c.indexOf(cname) == 0) return c.substring(cname.length, c.length);
  }
  return "";
}

// ページ読み込み時のチェック
document.addEventListener('DOMContentLoaded', () => {
  const currentPage = window.location.pathname.split('/').pop();
  const consent = getCookie('riyook');

// riyiki.html 以外のページで同意がなければリダイレクト
  if (currentPage !== 'termsofservice.html' && consent !== 'agreed') {
    window.location.href = 'termsofservice.html';
  }

  
  // 同意ボタン押下時にCookie保存（同意ボタンのIDが consent-button の場合）
  const consentButton = document.getElementById('consent-button');
  if (consentButton) {
    consentButton.addEventListener('click', () => {
      setCookie('riyook', 'agreed', 30); // 30日間保存
    });
  }
});
  </script>
